<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackjack Game Test Suite</title>
    <style>
        body {
            font-family: monospace;
            background: #1a1a1a;
            color: #00ff00;
            margin: 20px;
            line-height: 1.6;
        }
        .test-container {
            background: #2a2a2a;
            border: 1px solid #00ff00;
            padding: 20px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .status {
            padding: 10px;
            margin: 5px 0;
            border-radius: 3px;
        }
        .pass { background: #1a5a1a; border-left: 4px solid #00ff00; }
        .fail { background: #5a1a1a; border-left: 4px solid #ff0000; }
        .info { background: #1a1a5a; border-left: 4px solid #0080ff; }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border-radius: 3px;
            font-family: monospace;
            font-weight: bold;
        }
        button:hover { background: #00cc00; }
        #console { 
            height: 300px; 
            overflow-y: auto; 
            background: #000; 
            padding: 10px; 
            border: 1px solid #333; 
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üÉè Blackjack Game Test Suite</h1>
    
    <div class="test-container">
        <h2>üéØ Test Controls</h2>
        <button onclick="openBlackjackGame()">Open Blackjack Game</button>
        <button onclick="runIndividualTests()">Run Individual Tests</button>
        <button onclick="runFullTestSuite()">Run Full Test Suite</button>
        <button onclick="clearConsole()">Clear Console</button>
    </div>
    
    <div class="test-container">
        <h2>üìã Test Status</h2>
        <div id="testStatus" class="status info">Ready to run tests...</div>
    </div>
    
    <div class="test-container">
        <h2>üñ•Ô∏è Console Output</h2>
        <div id="console"></div>
    </div>
    
    <div class="test-container">
        <h2>üîß Manual Test Functions</h2>
        <p>Once blackjack game is open, you can run these in the console:</p>
        <ul>
            <li><code>runBlackjackTests()</code> - Full automated test suite</li>
            <li><code>testPlayerBust()</code> - Test player bust scenario</li>
            <li><code>testPlayerBlackjack()</code> - Test blackjack scenario</li>
            <li><code>testPlayerWin()</code> - Test player win scenario</li>
            <li><code>testDealerWin()</code> - Test dealer win scenario</li>
            <li><code>testPush()</code> - Test tie/push scenario</li>
        </ul>
    </div>

    <script>
        let blackjackWindow = null;
        
        function log(message, type = 'info') {
            const console = document.getElementById('console');
            const timestamp = new Date().toLocaleTimeString();
            const entry = `[${timestamp}] ${message}\n`;
            console.textContent += entry;
            console.scrollTop = console.scrollHeight;
            
            // Update status
            const status = document.getElementById('testStatus');
            status.textContent = message;
            status.className = `status ${type}`;
        }
        
        function clearConsole() {
            document.getElementById('console').textContent = '';
        }
        
        function openBlackjackGame() {
            log('üé∞ Opening blackjack game...', 'info');
            
            // Set up user data first
            localStorage.setItem('vegasUser', 'TestUser');
            localStorage.setItem('vegas.username', 'TestUser');
            localStorage.setItem('vegas.customerName', 'TestUser');
            localStorage.setItem('vegas.email', 'test@example.com');
            localStorage.setItem('vegas.companyName', 'Test Company');
            localStorage.setItem('vegas.persona', 'Customer');
            localStorage.setItem('vegas.booth', 'Test Booth');
            localStorage.setItem('vegas.optIn', 'true');
            localStorage.setItem('vegasBalance', '10000');
            
            blackjackWindow = window.open('http://localhost:8080/blackjack.html', 'blackjack', 'width=1200,height=800');
            
            if (blackjackWindow) {
                log('‚úÖ Blackjack window opened successfully', 'pass');
                
                // Wait for the window to load, then inject test script
                setTimeout(() => {
                    injectTestScript();
                }, 3000);
            } else {
                log('‚ùå Failed to open blackjack window', 'fail');
            }
        }
        
        function injectTestScript() {
            if (!blackjackWindow || blackjackWindow.closed) {
                log('‚ùå Blackjack window not available', 'fail');
                return;
            }
            
            try {
                // Inject the test script
                const script = blackjackWindow.document.createElement('script');
                script.src = '/test-blackjack-full.js';
                blackjackWindow.document.head.appendChild(script);
                
                log('üìã Test script injected into blackjack game', 'pass');
                
                // Also add our logging bridge
                const bridgeScript = blackjackWindow.document.createElement('script');
                bridgeScript.textContent = `
                    // Bridge console.log to parent window
                    const originalLog = console.log;
                    console.log = function(...args) {
                        originalLog.apply(console, args);
                        if (window.opener && window.opener.receiveLog) {
                            window.opener.receiveLog(args.join(' '));
                        }
                    };
                    
                    // Make test functions available globally
                    window.testReady = function() {
                        console.log('‚úÖ Test functions are ready!');
                        console.log('Available: runBlackjackTests(), testPlayerBust(), etc.');
                    };
                    
                    setTimeout(() => {
                        if (typeof runBlackjackTests === 'function') {
                            window.testReady();
                        } else {
                            console.log('‚ö†Ô∏è Test functions not loaded yet...');
                        }
                    }, 1000);
                `;
                blackjackWindow.document.head.appendChild(bridgeScript);
                
            } catch (error) {
                log(`‚ùå Error injecting test script: ${error.message}`, 'fail');
            }
        }
        
        function receiveLog(message) {
            log(`[GAME] ${message}`, 'info');
        }
        
        function runIndividualTests() {
            if (!blackjackWindow || blackjackWindow.closed) {
                log('‚ùå Please open blackjack game first', 'fail');
                return;
            }
            
            log('üß™ Running individual test scenarios...', 'info');
            
            const tests = [
                'testPlayerBust',
                'testPlayerBlackjack',
                'testPlayerWin',
                'testDealerWin',
                'testPush'
            ];
            
            let testIndex = 0;
            
            function runNextTest() {
                if (testIndex >= tests.length) {
                    log('‚úÖ All individual tests completed', 'pass');
                    return;
                }
                
                const testName = tests[testIndex];
                log(`üî¨ Running ${testName}...`, 'info');
                
                try {
                    blackjackWindow.eval(`
                        if (typeof ${testName} === 'function') {
                            ${testName}().then(() => {
                                console.log('‚úÖ ${testName} completed');
                            }).catch((error) => {
                                console.log('‚ùå ${testName} failed:', error);
                            });
                        } else {
                            console.log('‚ùå ${testName} function not available');
                        }
                    `);
                } catch (error) {
                    log(`‚ùå Error running ${testName}: ${error.message}`, 'fail');
                }
                
                testIndex++;
                setTimeout(runNextTest, 4000); // Wait 4 seconds between tests
            }
            
            runNextTest();
        }
        
        function runFullTestSuite() {
            if (!blackjackWindow || blackjackWindow.closed) {
                log('‚ùå Please open blackjack game first', 'fail');
                return;
            }
            
            log('üöÄ Running full automated test suite...', 'info');
            
            try {
                blackjackWindow.eval(`
                    if (typeof runBlackjackTests === 'function') {
                        runBlackjackTests().then(() => {
                            console.log('üéâ Full test suite completed!');
                        }).catch((error) => {
                            console.log('‚ùå Test suite failed:', error);
                        });
                    } else {
                        console.log('‚ùå runBlackjackTests function not available');
                        console.log('Available functions:', Object.keys(window).filter(k => k.startsWith('test')));
                    }
                `);
            } catch (error) {
                log(`‚ùå Error running test suite: ${error.message}`, 'fail');
            }
        }
        
        // Monitor blackjack window
        setInterval(() => {
            if (blackjackWindow && blackjackWindow.closed) {
                log('‚ö†Ô∏è Blackjack window was closed', 'info');
                blackjackWindow = null;
            }
        }, 1000);
        
        log('üéÆ Test suite ready! Click "Open Blackjack Game" to start testing.', 'pass');
    </script>
</body>
</html>